#include <stdio.h>
#include <conio.h>
#include <iostream>
#include <string>
#include <iterator>
#include <math.h>

#define MAXBUFLEN 100000
struct contunt
{
    char country[20];
    int pplcount[255];
    int cont[1];
};
void main()
{
//////////////////////////////////////////////////////////////////
	char choosetime;
	char cymbol = 254, nb = '\n';
	choseme:
	printf("Choose what to do\nPress 1 to add entity\nPress 2 to view/delete records\nPress 3 to use special task\n");
	scanf("%c",&choosetime);
	switch (choosetime){
	case '1':
		system("cls");
            goto adding;
           break;
         case '2':
			 system("cls");
            goto listing;
			break;
		 case '3':
			 system("cls");
			 goto special;
			 break;
         default:
            system("cls");
			goto choseme;
			break;
	}

//////////////////////////////////////////////////////////////////
adding:
	int n,i;
	char temp[255];
	printf("Enter number of entities to add>"); 
	scanf("%i",&n);
	contunt* cnt=new contunt[n];
		for (int i=0;i<n;i++)
		{
			getchar();
			printf("\n\nCountry: ");
			gets(cnt[i].country);
			printf("\nContinent (1-6): ");
			scanf("%i",&cnt[i].cont);
			printf("\nPeopleCount: ");
			scanf("%i",&cnt[i].pplcount);
		}
	char str[MAXBUFLEN];
	i=0;
	
	FILE *fp;
	if((fp=fopen("test.dat","r"))==0)
		printf("Error!\n");
	else
	{
		while(!feof(fp))
		{
			char c=getc(fp);
			if (!feof(fp))
			str[i]=c;
			i++;
			str[i+1]='\0';
		}
		fclose(fp);
	}
	FILE *fp2;
	fp2=fopen("test.dat","w");
	fputs(str,fp2);
	for (int i=0;i<n;i++)
	{	
		char temp2[255] = {"Country name: "};
		char temp3[255] = {"Continent: "};
		char temp4[255] = {"Population: "};

		fputc(nb,fp2);
		fputc(cymbol,fp2);	
		fputs(temp2,fp2);
		fputs(cnt[i].country,fp2);
		fputc(nb,fp2);
		fputc(cymbol,fp2);
		itoa(*cnt[i].cont,temp,10);
		fputs(temp3,fp2);
		fputs(temp,fp2);
		fputc(nb,fp2);
		fputc(cymbol,fp2);
		fputs(temp4,fp2);
		itoa(*cnt[i].pplcount,temp,10);
		fputs(temp,fp2);
	}
	fclose(fp2);
system("cls");
//////////////////////////////////////////////////////////////////
listing:
		int check = (-1),checknumber=1;
	FILE *fp3;
	if((fp3=fopen("test.dat","r"))==0)
		printf("Error!\n");
	else
	{
		while(!feof(fp3))
		{
			char c=getc(fp3);
			if (!feof(fp3))
				if (c==cymbol)
					{check++;
			if (check == 0){printf("     -%i- \n",checknumber);};
			if (check % 3==0 && check != 0){checknumber++;printf("\n\n");printf("     -%i- \n",checknumber);}}
				else printf("%c",c);
				
		}
		fclose(fp3);
	}
	printf("\n\n\nPress 1 to get back to the main menu\nPress 2 to delete specific entity: ");
scanf(" %c",&choosetime);
switch (choosetime){
case '1' :
	system("cls");
	goto choseme;
	break;
case '2' :
	goto deleting;
	break;}
////////////////////////////////////////////////////////////////

special:
	int continents,cymbcnt=0;
	bool trus=true,insidetrus=true;
	int zze = (1%3);
	int tempd,ii=0,it0=0;
	int avgsum=0,countryentries=0,adresses;
	char conten[255];
printf("Type in the number of the continent to see its avg. population: ");
scanf(" %i",&continents);
char strs[MAXBUFLEN];
	i=0;	
	FILE *fpv;
	if((fpv=fopen("test.dat","r"))==0)
		printf("Error!\n");
	else
	{
		while(!feof(fpv))
		{
			char c=getc(fpv);
			if (!feof(fpv))
			strs[i]=c;
			i++;
			strs[i+1]='\0';
		}
		fclose(fpv);
	}
	//
	trus = true;
	i=0;cymbcnt=(-1);
	while (trus==true){			
			if(strs[i]==cymbol){cymbcnt++;tempd=cymbcnt;}
			if(tempd%3==zze)/*Proverka na nomer kontinenta*/{tempd=0;adresses = strs[i+12]-48;insidetrus=true;}
			if(adresses == continents){ii=i+12+15;it0=0;countryentries=countryentries+1;
			while(insidetrus==true){conten[it0]=strs[ii];it0++;ii++;
			if(strs[ii]==cymbol || strs[ii]=='\0'){insidetrus=false;
			avgsum=avgsum+atoi(conten);ii=0;it0=0;adresses++;}
			}}
			i++;
	if(str[i]=='\0'){trus=false;}}
	avgsum=avgsum/countryentries;
	printf("\n\n\nAverage citizen count in countries of this contenent %i = %i , total countries in that segment %i\n\n\nPress Any key to return to main menu",continents,avgsum,countryentries);
	getch();
goto choseme;
////////////////////////////////////////////////////////////////

deleting:
char strs2[MAXBUFLEN];
	i=0;	
	FILE *fpz;
	if((fpz=fopen("test.dat","r"))==0)
		printf("Error!\n");
	else
	{
		while(!feof(fpz))
		{
			char c=getc(fpz);
			if (!feof(fpz))
			strs2[i]=c;
			i++;
			strs2[i+1]='\0';
		}
		fclose(fpz);
	}

	int which=0;
	printf("\n\n\nType in the number of entiny which you would like to remove: ");
	scanf(" %i",&which);
	
	int wheresend=(which*3)+1;
	int wheresstart=wheresend-3;
	int startpos=0,endpos=0;
	if (which==1){endpos=1;};
	int len = strlen(strs2);
	cymbcnt=0;
	trus=true;
	int qeta=0;
	while (trus==true){
			if(strs2[qeta]==cymbol){
			cymbcnt++;
			if(cymbcnt==wheresstart){startpos=qeta;};
			if(cymbcnt==wheresend){endpos=(endpos+qeta);trus=false;};};
			qeta=qeta+1;}
	std::string strx = strs2;
	int lenofsymb = endpos-startpos;
	if (which==1){strx.erase(startpos, lenofsymb-1);}
	else {strx.erase(startpos, lenofsymb);};	
	char* typeitall = new char[len + 1];
	typeitall = (char*)strx.c_str();
	FILE *fpx;
	fpx=fopen("test.dat","w");
	fputs(typeitall,fpx);
	fclose(fpx);
system("cls");
goto listing;
////////////////////////////////////////////////////////////////
	}
